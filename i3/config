# vim: filetype=i3config
# Be sure that you have your $BROWSER environmental variable set to your favorite browser.
# E.g., put `export BROWSER="firefox"` into your bash_profile

# #---Basic Definitions---# #
#font pango:Noto Sans Bold 10
font pango:Noto Sans 10
set $mod Mod4
set $term --no-startup-id /usr/local/bin/st

# SYSTEMD
set $shutdown sudo shutdown -h now
set $reboot sudo reboot
set $netrefresh --no-startup-id sudo systemctl restart NetworkManager
set $suspend sudo systemctl suspend

# SET DEFAULT LAYOUT
workspace_layout tabbed

## SET COLOURS
##                       border    backgr.   text      indicator  child_border
client.focused           #0099ff   #0099ff   #fdf6e3   #ff0000    #285577
#client.focused           #c8c800  #c8c800   #000000   #ff0000    #285577
client.focused_inactive  #005086   #005086   #fdf6e3   #ff0000    #285577
#client.focused_inactive  #bfd800   #bfd800   #202020   #ff0000    #285577
#client.unfocused         #001523   #001523   #888888   #ff0000    #285577
client.unfocused         #002843   #002843   #888888   #ff0000    #285577
#client.unfocused         #4b4c47   #4b4c47   #888888   #ff0000    #285577

default_border normal 2
default_floating_border normal 0

# reload the configuration file
bindsym $mod+Shift+c reload

# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart

# exit i3 (logs you out of your X session)
bindsym $mod+Shift+e    exec --no-startup-id "i3-nagbar -t warning -m 'Vuoi veramente terminare i3?' -b 'Si, termina i3' 'i3-msg exit'"

# reboot
bindsym $mod+Shift+BackSpace    exec --no-startup-id "i3-nagbar -t warning -m 'Vuoi riavviare il computer?' -b 'Si, riavvia' '$reboot'"

# shutdown
bindsym $mod+Shift+x    exec --no-startup-id "i3-nagbar -t warning -m 'Vuoi spegnere il computer?' -b 'Si, spegni' '$shutdown'"

# Alt-TAB
set $i3t_alt_tab        ~/.scripts/i3t.py n
set $i3t_alt_shift_tab  ~/.scripts/i3t.py p
bindsym Mod1+Tab        exec --no-startup-id $i3t_alt_tab
bindsym Mod1+Shift+Tab  exec --no-startup-id $i3t_alt_shift_tab

# change focus
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# split in horizontal orientation
bindsym $mod+b split h

# split in vertical orientation
bindsym $mod+v split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

# focus the parent container
bindsym $mod+a focus parent

# focus the child container
bindsym $mod+Shift+a focus child

# Pulse Audio controls
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume 0 +5% #increase sound volume
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume 0 -5% #decrease sound volume
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute 0 toggle # mute/unmute sound
exec --no-startup-id pactl set-sink-mute 0 0

# Screen brightness controls
bindsym XF86MonBrightnessUp exec --no-startup-id  light -b -A 5
bindsym XF86MonBrightnessDown exec --no-startup-id light -b -U 5

# Media player controls
bindsym XF86AudioPlay exec --no-startup-id playerctl -p mpd play-pause
bindsym XF86AudioStop exec --no-startup-id playerctl -p mpd stop
bindsym XF86AudioNext exec --no-startup-id playerctl -p mpd next
bindsym XF86AudioPrev exec --no-startup-id playerctl -p mpd previous

# Volume keys
bindsym $mod+plus           exec --no-startup-id playerctl volume .05+
bindsym $mod+Shift+plus     exec --no-startup-id playerctl volume .2+
bindsym $mod+minus          exec --no-startup-id playerctl volume .05-
bindsym $mod+Shift+minus    exec --no-startup-id playerctl volume .2

#bar {
#    status_command i3blocks
#    position top
#    mode dock
#    modifier None
#}

# #---Basic Bindings---# #
bindsym $mod+Return             exec $term

bindsym $mod+Escape             workspace prev

bindsym $mod+Shift+Escape       exec ~/.scripts/exit_menu.sh
bindsym $mod+Shift+Tab          exec ~/.scripts/window_chooser.sh


# #---Letter Key Bindings---# #
##bindsym $mod+q          kill
bindsym $mod+Shift+q    kill

bindsym $mod+Shift+w    exec --no-startup-id firefox

bindsym $mod+r          exec $term -t vifm -e vifm

bindsym $mod+t          split toggle

bindsym $mod+u          [title="dropdown"] scratchpad show; [title="dropdown"] move position center

bindsym $mod+i          exec $term -e htop

bindsym $mod+o          sticky toggle

bindsym $mod+Shift+p    exec --no-startup-id mypaint; workspace $ws2

bindsym $mod+Shift+d    exec --no-startup-id dmenu_run
bindsym $mod+d          exec --no-startup-id rofi -show drun -theme sidebar -show-icons -drun-show-actions -icon-theme breeze-dark
bindsym $mod+Shift+h    exec --no-startup-id rofi -show ssh -width 50 -lines 10  -theme Monokai -terminal $term

bindsym $mod+g          workspace prev
bindsym $mod+Shift+g    exec --no-startup-id gimp; workspace $ws2

bindsym $mod+x          exec --no-startup-id ~/.config/i3/lock.sh

bindsym $mod+c          exec --no-startup-id ~/.scripts/camtoggle

bindsym $mod+m          exec --no-startup-id  $term -e ncmpcpp

bindsym $mod+Shift+v    exec --no-startup-id projectMSDL

bindsym $mod+Shift+s    exec --no-startup-id tabbed surf -e

# Resize window (you can also use the mouse for that)
bindsym $mod+p mode "resize"
mode "resize" {
        bindsym j resize shrink width 5 px or 5 ppt
        bindsym k resize grow height 5 px or 5 ppt
        bindsym l resize shrink height 5 px or 5 ppt
        bindsym ograve resize grow width 5 px or 5 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # exit resize mode: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

# Set shut down, restart and locking features
bindsym $mod+y mode "$mode_system"
set $mode_system (l)ock, (e)xit, switch_(u)ser, (s)uspend, (r)eboot, (Shift+s)hutdown
mode "$mode_system" {
    bindsym l exec --no-startup-id ~/.config/i3/lock.sh, mode "default"
    bindsym s exec --no-startup-id $suspend, mode "default"
    bindsym u exec --no-startup-id i3exit switch_user, mode "default"
    bindsym e exec --no-startup-id i3-msg exit, mode "default"
    bindsym r exec --no-startup-id $reboot, mode "default"
    bindsym Shift+s exec --no-startup-id $shutdown, mode "default"

    # exit system mode: "Enter" or "Escape"
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

# #---Workspace Bindings---# #
bindsym $mod+Home           workspace $ws1
bindsym $mod+Shift+Home     move container to workspace $ws1
bindsym $mod+End            workspace $ws10
bindsym $mod+Shift+End      move container to workspace $ws10
bindsym $mod+Prior          workspace prev
bindsym $mod+Shift+Prior    move container to workspace prev
bindsym $mod+Next           workspace next
bindsym $mod+Shift+Next     move container to workspace next
bindsym $mod+Tab            workspace back_and_forth
bindsym $mod+XF86Back       workspace prev
bindsym $mod+XF86Forward    workspace next
bindsym $mod+semicolon      workspace next
bindsym $mod+apostrophe     split horizontal ;; exec $term
bindsym $mod+slash          split vertical ;; exec $term
bindsym $mod+backslash      workspace back_and_forth

## Manual management of external displays
# Set the shortcuts and what they do
set $mode_display Ext Screen (v) VGA ON, (h) HDMI ON, (x) VGA OFF, (y) HDMI OFF
mode "$mode_display" {
    #bindsym v exec --no-startup-id xrandr --output VGA1 --auto --right-of eDP-1, mode "default"
    #bindsym h exec --no-startup-id xrandr --output HDMI-1 --auto --right-of eDP-1, mode "default"
    bindsym h exec --no-startup-id ~/.scripts/start_multimonitor, mode "default"
    #bindsym x exec --no-startup-id xrandr --output VGA1 --auto --off, mode "default"
    #bindsym y exec --no-startup-id xrandr --output HDMI-1 --auto --off, mode "default"
    bindsym y exec --no-startup-id ~/.scripts/stop_multimonitor, mode "default"

    # back to normal: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
# Declare here the shortcut to bring the display selection menu
bindsym $mod+z mode "$mode_display"

set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

workspace 5 output HDMI-1
#workspace 1 output eDP-1
#workspace 2 output eDP-1
# switch to workspace
bindsym $mod+1      workspace $ws1
bindsym $mod+2      workspace $ws2
bindsym $mod+3      workspace $ws3
bindsym $mod+4      workspace $ws4
bindsym $mod+5      workspace $ws5
bindsym $mod+6      workspace $ws6
bindsym $mod+7      workspace $ws7
bindsym $mod+8      workspace $ws8
bindsym $mod+9      workspace $ws9
bindsym $mod+0      workspace $ws10

# move focused container to workspace
bindsym $mod+Shift+1    move container to workspace $ws1
bindsym $mod+Shift+2    move container to workspace $ws2
bindsym $mod+Shift+3    move container to workspace $ws3
bindsym $mod+Shift+4    move container to workspace $ws4
bindsym $mod+Shift+5    move container to workspace $ws5
bindsym $mod+Shift+6    move container to workspace $ws6
bindsym $mod+Shift+7    move container to workspace $ws7
bindsym $mod+Shift+8    move container to workspace $ws8
bindsym $mod+Shift+9    move container to workspace $ws9
bindsym $mod+Shift+0    move container to workspace $ws10

# I'll later bind this to mod+u.
#exec --no-startup-id $term -t dropdown -e calc
#for_window [title="dropdown"] floating enable
#for_window [title="dropdown"] resize set 800 600
#for_window [title="dropdown"] resize set 625 400
#for_window [title="dropdown"] move scratchpad
#for_window [title="dropdown"] border pixel 1

# Bindings to make the webcam float and stick.
for_window [title="mpvfloat"] floating enable
for_window [title="mpvfloat"] sticky enable
for_window [title="mpvfloat"] border pixel 0
no_focus [title="mpvfloat"]

for_window [title="Default - Wine desktop"] floating enable

# #---Function Buttons---# #
bindsym $mod+F1     exec --no-startup-id okular ~/.config/i3/i3_guide.pdf
bindsym $mod+F2     restart
bindsym $mod+F3     exec --no-startup-id displayselect
bindsym $mod+F4     exec --no-startup-id $suspend
bindsym $mod+F5     exec --no-startup-id $netrefresh
##bindsym $mod+F6     exec --no-startup-id $term -e transmission-remote-cli
##bindsym $mod+F7
##bindsym $mod+F8
bindsym $mod+F9     exec --no-startup-id $term -t gotop -e gotop -c solarized -s -b
bindsym $mod+F10 exec --no-startup-id ~/.local/bin/quickswitch.py -j -e -f -C Polybar
bindsym $mod+F11 exec --no-startup-id ~/.local/bin/quickswitch.py -m -C Polybar
bindsym $mod+F12 exec --no-startup-id ~/.local/bin/quickswitch.py -C Polybar

# #---Arrow Keys---# #
bindsym $mod+Left       focus left
bindsym $mod+Down       focus down
bindsym $mod+Up         focus up
bindsym $mod+Right      focus right
bindsym $mod+Shift+Left     move left
bindsym $mod+Shift+Down     move down
bindsym $mod+Shift+Up       move up
bindsym $mod+Shift+Right    move right

# For screenshots and recording
bindsym Print           exec --no-startup-id spectacle
#bindsym Shift+Print     exec --no-startup-id scrot '%Y-%m-%d_$wx$h.png' -e 'mv $f ~/shots/'
bindsym Shift+Print     exec --no-startup-id maim -s ~/shots/$(date +%s).png

# #---Extra XF86 Keys---# #
# These are the extra media keys that some keyboards have.
bindsym XF86Calculator  exec --no-startup-id kcalc
bindsym XF86Sleep       exec sudo zzz
bindsym XF86WWW         exec --no-startup-id firefox
bindsym XF86ScreenSaver exec --no-startup-id ~/.scripts/monitor-off
bindsym XF86WebCam      exec --no-startup-id ~/.scripts/camtoggle

for_window [class="(?i)qsynth"] floating enable
for_window [class="(?i)copyq"] floating enable
for_window [class="(?i)nvidia"] floating enable
for_window [class="(?i)pcsx"] floating enable
for_window [class="(?i)arandr"] floating enable
for_window [class="(?i)beebeep"] floating enable
for_window [class="(?i)qjack"] floating enable
for_window [class="Yad"] floating enable
for_window [title="Calendario"] border pixel 1

# #---Starting External Scripts---# #
exec --no-startup-id /usr/bin/kuiserver5

exec --no-startup-id /usr/libexec/dconf-service

exec --no-startup-id /usr/libexec/gconfd-2

# Disable DPMS
exec --no-startup-id xset s off -dpms

# Composite manager:
exec --no-startup-id compton

# Setting the background:
#exec_always --no-startup-id feh --bg-fill ~/.config/i3/sardinia.jpg
exec_always --no-startup-id "sleep 3; feh --bg-fill ~/.config/i3/001.png"

# Launch Polybar where appropriate:
#exec --no-startup-id "sleep 2; polybar top -c ~/.config/polybar/config &"
exec --no-startup-id "sleep 3; polybar top -r &"

# Starts dunst for notifications:
exec --no-startup-id dunst

# Music player daemon:
exec --no-startup-id mpDris2

# Torrent daemon:
#exec --no-startup-id transmission-daemon
#exec --no-startup-id transmission-qt

# Runs the key remapping scripts
#exec --no-startup-id ~/.scripts/remaps

# xbanish - hide the X11 mouse cursor when a key is pressed
exec --no-startup-id xbanish

# Network Manager applet
exec --no-startup-id nm-applet

# Automounter
exec --no-startup-id udiskie -t -f dolphin

# Clipboard manager
exec --no-startup-id "env XDG_CURRENT_DESKTOP=i3 QT_QPA_PLATFORMTHEME='qt5ct' copyq"

# Redshift
exec --no-startup-id redshift-gtk

# Touchpad tap and speed
exec --no-startup-id xinput set-prop 14 289 1
exec --no-startup-id xinput set-prop 14 309 0.8

# Conky
exec --no-startup-id "sleep 1; conky -c ~/.conky/conkyrc_i3"
exec --no-startup-id "sleep 1; conky -c ~/.conky/Gotham/Gotham_i3"
exec --no-startup-id "sleep 1; cd ~/.conky-weather/; ./run"

# IT keymap
exec --no-startup-id setxkbmap

# Allow run some GUI apps as root
exec --no-startup-id /usr/libexec/kf5/polkit-kde-authentication-agent-1

# KDE Connect
exec --no-startup-id "sleep 5; env XDG_CURRENT_DESKTOP=i3 QT_QPA_PLATFORMTHEME='qt5ct' kdeconnect-indicator"

